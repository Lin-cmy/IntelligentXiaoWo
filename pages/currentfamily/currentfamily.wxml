<!-- 标题 -->
<view class="current-family-container">
  <view class="current-family-header">
    <text class="current-family-name">{{homename}}</text>
    <!-- 房主才显示申请管理按钮 -->
    <view wx:if="{{role === '房主'}}" class="request-manage-btn" bindtap="showRequests">
      <view class="notification-dot" wx:if="{{requests.length > 0}}"></view>
      <view class="manage-icon">
        <view class="manage-icon-bar"></view>
        <view class="manage-icon-bar"></view>
        <view class="manage-icon-bar"></view>
      </view>
    </view>
  </view>

<!-- 家庭信息 -->
  <view class="current-family-section1">
    <view class="current-family-message" bindtap="onNameTap">
      <view class="msg-left">
        <text class="part1">家庭名称</text>
      </view>
      <view class="msg-right">
        <text class="part2">{{homename}}</text>
        <text class="part3">></text>
      </view>
    </view>
    <view class="current-family-message" bindtap="onAddressTap">
      <view class="msg-left">
        <text class="part1">家庭位置</text>
      </view>
      <view class="msg-right">
        <text class="part2">{{homeaddress}}</text>
        <text class="part3">></text>
      </view>
    </view>
    <view class="current-family-message" bindtap="onRandDTap" data-homeid="{{homeId}}">
      <view class="msg-left">
        <text class="part1">房间及设备管理</text>
      </view>
      <view class="msg-right">
        <text class="part2">{{devicecnt}}个设备</text>
        <text class="part3">></text>
      </view>
    </view>
  </view>

<!-- 家庭成员 -->
  <text class="family-member">家庭成员</text>
  <view class="current-family-section2">
    <text class="member-introduction">所有成员均可使用家庭内的设备</text>
    <block wx:for="{{homemembers}}" wx:key="id">
      <view class="member-item" bindtap="onMemberTap" data-id="{{item.id}}">
        <image class="member-icon" src="/images/user/用户头像.png"></image>
        <text class="member-name">{{item.name}}</text>
      </view>
    </block>
    <view class="member-item">
      <view class="member-icon add-member-icon" bindtap="onAddTap"></view>
      <text class="member-name">添加成员</text>
    </view>
  </view>
</view>

<!-- 修改家庭名称弹窗 -->
<view wx:if="{{showChangeHomeNamePopup}}" class="popup-change" catchtouchmove="true">
  <view class="popup-content">
    <text class="popup-title">修改家庭名称</text>
    <view class="popup-desc">为您的家庭起一个温馨的名字</view>
    <input 
      class="popup-input"
      placeholder="请输入家庭名称"
      value="{{newhomename}}"
      bindinput="onHomeNameInput"
      maxlength="20"
    />
    <view class="popup-btns">
      <button class="popup-btn cancel" bindtap="onPopupCloseHomename">取消</button>
      <button class="popup-btn confirm" bindtap="onConfirmChangeHomename">确定</button>
    </view>
  </view>
</view>

<!-- 修改家庭位置弹窗 -->
<view wx:if="{{showChangeHomeAddressPopup}}" class="popup-change" catchtouchmove="true">
  <view class="popup-content">
    <text class="popup-title">修改家庭地址</text>
    <view class="popup-desc">请输入您的家庭详细地址</view>
    <input 
      class="popup-input"
      placeholder="请输入家庭地址"
      value="{{newhomeaddress}}"
      bindinput="onHomeAddressInput"
      maxlength="50"
    />
    <view class="popup-btns">
      <button class="popup-btn cancel" bindtap="onPopupCloseHomeaddress">取消</button>
      <button class="popup-btn confirm" bindtap="onConfirmChangeHomeaddress">确定</button>
    </view>
  </view>
</view>

<!-- 添加成员弹窗 -->
<view wx:if="{{showAddMemberPopup}}" class="popup-change" catchtouchmove="true">
  <view class="popup-content">
    <text class="popup-title">添加家庭成员</text>
    <view class="popup-desc">通过手机号添加家庭成员</view>
    <input 
      class="popup-input"
      placeholder="请输入成员手机号"
      value="{{userphone}}"
      bindinput="onMemberPhoneInput"
      maxlength="11"
      type="number"
    />
    <view class="popup-btns">
      <button class="popup-btn cancel" bindtap="onAddMemberCancel">取消</button>
      <button class="popup-btn confirm" bindtap="onAddMemberConfirm">确定</button>
    </view>
  </view>
</view>

<!-- 申请记录弹窗 -->
<view wx:if="{{showRequestsPopup}}" class="popup-change" catchtouchmove="true">
  <view class="popup-content requests-popup">
    <text class="popup-title">访客申请</text>
    <view class="popup-desc">管理希望访问您家庭的用户申请</view>
    
    <scroll-view class="requests-list" scroll-y>
      <block wx:if="{{requests.length > 0}}">
        <view wx:for="{{requests}}" wx:key="requestId" class="request-item">
          <view class="request-user">
            <view class="request-avatar"></view>
            <text class="request-username">{{item.userName}}</text>
          </view>
          <view class="request-actions">
            <button 
              class="request-btn accept" 
              bindtap="handleRequest" 
              data-request-id="{{item.requestId}}" 
              data-user-id="{{item.userId}}"
              data-status="1"
            >同意</button>
            <button 
              class="request-btn reject" 
              bindtap="handleRequest" 
              data-request-id="{{item.requestId}}" 
              data-userid="{{item.userId}}"
              data-status="2"
            >拒绝</button>
          </view>
        </view>
      </block>
      <view wx:else class="no-requests">
        <text>暂无访客申请</text>
      </view>
    </scroll-view>
    
    <view class="popup-btns single-btn">
      <button class="popup-btn confirm" bindtap="closeRequests">关闭</button>
    </view>
  </view>
</view>