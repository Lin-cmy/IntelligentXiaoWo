<view class="detail-container">
  <!-- é¡¶éƒ¨èƒŒæ™¯å›¾å’Œæ ‡é¢˜ -->
  <view class="header-section">
    <image class="bg-image" src="/images/scene-bg.jpg" mode="aspectFill"></image>
    <view class="header-content">
      <view class="back-icon" bindtap="onBack">â†</view>
      <view class="like-icon">ğŸ‘</view>
    </view>
    <view class="title-section">
      <!-- å¯ç¼–è¾‘çš„åœºæ™¯åç§° -->
      <view class="title" wx:if="{{!isEditingName}}" bindtap="editSceneName">{{sceneName}}</view>
      <input class="title-input" wx:else focus="{{true}}" value="{{sceneName}}" bindblur="saveSceneName"></input>
      
      <!-- å¯ç¼–è¾‘çš„åœºæ™¯æè¿° -->
      <view class="desc" wx:if="{{!isEditingDesc}}" bindtap="editSceneDesc">{{sceneDesc}}</view>
      <input class="desc-input" wx:else focus="{{true}}" value="{{sceneDesc}}" bindblur="saveSceneDesc"></input>
    </view>
  </view>

  <!-- å·²é€‰è®¾å¤‡åˆ—è¡¨ï¼ˆé€šç”¨ä¿¡æ¯åŒºï¼‰ -->
  <view class="content-section">
    <view class="section-title">å·²é€‰æ‹©è®¾å¤‡</view>
    
    <!-- ä¼ æ„Ÿå™¨è®¾å¤‡è¡¨æ ¼ (éæ§åˆ¶ç±»è®¾å¤‡) -->
    <view class="data-section" wx:if="{{sensorDevices.length > 0}}">
      <view class="data-table-container">
        <view class="table-header">
          <view class="table-cell name-cell">è®¾å¤‡åç§°</view>
          <view class="table-cell type-cell">è®¾å¤‡ç±»å‹</view>
          <view class="table-cell time-cell">æ›´æ–°æ—¶é—´</view>
          <view class="table-cell value-cell">å±æ€§å€¼</view>
        </view>
        
        <scroll-view class="table-body" scroll-y>
          <block wx:if="{{sensorDevices.length > 0}}">
            <view class="table-row" wx:for="{{sensorDevices}}" wx:key="id">
              <view class="table-cell name-cell">
                {{item.name}}
                <view class="remove-icon" bindtap="removeDevice" data-device-id="{{item.id}}">Ã—</view>
              </view>
              <view class="table-cell type-cell">{{item.type}}</view>
              <view class="table-cell time-cell">{{item.latestTime}}</view>
              <view class="table-cell value-cell">{{item.latestValue}}</view>
            </view>
          </block>
          <view wx:else class="empty-data">
            <text>æš‚æ— ä¼ æ„Ÿå™¨æ•°æ®</text>
          </view>
        </scroll-view>
      </view>
      
      <!-- åˆ·æ–°æŒ‰é’® -->
      <view class="refresh-container">
        <button class="refresh-btn" bindtap="refreshData">
          <text class="refresh-icon">â†»</text>
          <text>åˆ·æ–°æ•°æ®</text>
        </button>
      </view>
    </view>
    
    <!-- æ§åˆ¶è®¾å¤‡åˆ—è¡¨ (55, 88, 99) -->
    <view wx:if="{{controlDevices.length > 0}}">
      <!-- éå†æ§åˆ¶è®¾å¤‡ -->
      <view class="control-devices">
        <view class="device-control-card" wx:for="{{controlDevices}}" wx:key="id">
          <view class="device-header">
            <view class="device-info">
              <view class="device-name">{{item.name}}</view>
              <view class="device-type">{{item.type}}</view>
            </view>
            <view class="remove-btn" bindtap="removeDevice" data-device-id="{{item.id}}">
              <text>Ã—</text>
            </view>
          </view>
          
          <!-- é£æ‰‡æ§åˆ¶å™¨ (deviceTypeId: 55 æˆ– 99) -->
          <view class="fan-control" wx:if="{{item.typeId == '55' || item.typeId == '99'}}">
            <view class="control-description">{{item.typeId == '55' ? 'é£æ‰‡' : 'æ°´æ³µ'}}æŒ¡ä½æ§åˆ¶</view>
          
            <view class="fan-levels">
              <view class="fan-level {{item.selectedLevel == 0 ? 'selected' : ''}}" 
                bindtap="selectLevel" data-device-id="{{item.id}}" data-level="0">
                <view class="level-icon level-off">â—</view>
                <text>å…³é—­</text>
              </view>
            
              <view class="fan-level {{item.selectedLevel == 1 ? 'selected' : ''}}" 
                bindtap="selectLevel" data-device-id="{{item.id}}" data-level="1">
                <view class="level-icon level-low">â—</view>
                <text>ä½é€Ÿ</text>
              </view>
            
              <view class="fan-level {{item.selectedLevel == 2 ? 'selected' : ''}}" 
                bindtap="selectLevel" data-device-id="{{item.id}}" data-level="2">
                <view class="level-icon level-medium">â—</view>
                <text>ä¸­é€Ÿ</text>
              </view>
            
              <view class="fan-level {{item.selectedLevel == 3 ? 'selected' : ''}}" 
                bindtap="selectLevel" data-device-id="{{item.id}}" data-level="3">
                <view class="level-icon level-high">â—</view>
                <text>é«˜é€Ÿ</text>
              </view>
            
              <view class="fan-level {{item.selectedLevel == 4 ? 'selected' : ''}}" 
                bindtap="selectLevel" data-device-id="{{item.id}}" data-level="4">
                <view class="level-icon level-auto">â—</view>
                <text>è‡ªåŠ¨</text>
              </view>
            </view>
          </view>
        
          <!-- ç¯å…‰æ§åˆ¶å™¨ (deviceTypeId: 88) -->
          <view class="light-control" wx:if="{{item.typeId == '88'}}">
            <view class="control-description">ç¯å…‰äº®åº¦æ§åˆ¶</view>
          
            <view class="light-buttons">
              <view class="light-button {{item.selectedLevel == 0 ? 'selected' : ''}}" 
                bindtap="selectLevel" data-device-id="{{item.id}}" data-level="0">
                <view class="light-icon light-off">â—‹</view>
                <text>å…³é—­</text>
              </view>
            
              <view class="light-button {{item.selectedLevel == 101 ? 'selected' : ''}}" 
                bindtap="selectLevel" data-device-id="{{item.id}}" data-level="101">
                <view class="light-icon light-auto">âŸ³</view>
                <text>è‡ªåŠ¨</text>
              </view>
            </view>
          
            <view class="brightness-control">
              <text class="brightness-label">äº®åº¦: {{item.selectedLevel == 0 ? 'å…³é—­' : item.selectedLevel == 101 ? 'è‡ªåŠ¨' : item.selectedLevel + '%'}}</text>
              <slider 
                min="1" 
                max="100" 
                step="1" 
                activeColor="#7FB69F" 
                backgroundColor="#e0e0e0"
                blockSize="28"
                value="{{item.selectedLevel >= 0 && item.selectedLevel <= 100 ? item.selectedLevel : 0}}"
                bindchange="onSliderChange"
                data-device-id="{{item.id}}"
              />
            </view>
          </view>
          
          <!-- ç¡®è®¤æŒ‰é’® -->
          <view class="confirm-container">
            <button class="confirm-btn" bindtap="confirmOperation" data-device-id="{{item.id}}">
              ç¡®è®¤è®¾ç½®
            </button>
          </view>
        </view>
      </view>
    </view>
    
    <view class="empty-devices" wx:if="{{selectedDevices.length === 0}}">
      <text>æš‚æ— æ·»åŠ è®¾å¤‡ï¼Œè¯·ç‚¹å‡»ä¸‹æ–¹æŒ‰é’®æ·»åŠ </text>
    </view>

    <!-- æ·»åŠ è®¾å¤‡æŒ‰é’® -->
    <view class="add-device-btn" bindtap="showDeviceList">
      <text class="plus-icon">+</text>
      <text>æ·»åŠ è®¾å¤‡</text>
    </view>
  </view>

  <!-- æ—¥æœŸé€‰æ‹© -->
  <view class="content-section">
    <view class="section-title">ç”Ÿæ•ˆæ—¥æœŸ</view>
    <view class="form-section">
      <view class="date-picker-row">
        <text>å¼€å§‹æ—¥æœŸï¼š</text>
        <picker mode="date" value="{{startDate}}" bindchange="bindStartDateChange">
          <view class="date-picker-value">{{startDate || 'è¯·é€‰æ‹©'}}</view>
        </picker>
      </view>
      <view class="date-picker-row">
        <text>ç»“æŸæ—¥æœŸï¼š</text>
        <picker mode="date" value="{{endDate}}" bindchange="bindEndDateChange">
          <view class="date-picker-value">{{endDate || 'è¯·é€‰æ‹©'}}</view>
        </picker>
      </view>
    </view>
  </view>
  
  <!-- æ—¶é—´é€‰æ‹© -->
  <view class="content-section">
    <view class="section-title">ç”Ÿæ•ˆæ—¶é—´æ®µ</view>
    <view class="time-picker" bindtap="onTimeRange">
      <text>{{timeRange}}</text>
      <text class="arrow">â–¼</text>
    </view>
  </view>

  <!-- æ—¶é—´é€‰æ‹©å™¨å¼¹çª— -->
  <view class="time-picker-modal" wx:if="{{showTimePicker}}" catchtouchmove="true">
    <view class="modal-mask" bindtap="hideTimePicker"></view>
    <view class="modal-content">
      <view class="modal-header">
        <text>é€‰æ‹©æ—¶é—´</text>
        <text class="close-btn" bindtap="hideTimePicker">Ã—</text>
      </view>
      <view class="time-picker-content">
        <view class="time-picker-item">
          <text>å¼€å§‹æ—¶é—´</text>
          <picker mode="time" value="{{startTime}}" bindchange="bindStartTimeChange">
            <view class="time-selector">{{startTime}}</view>
          </picker>
        </view>
        <view class="time-picker-item">
          <text>ç»“æŸæ—¶é—´</text>
          <picker mode="time" value="{{endTime}}" bindchange="bindEndTimeChange">
            <view class="time-selector">{{endTime}}</view>
          </picker>
        </view>
      </view>
      <button class="confirm-btn" bindtap="hideTimePicker">ç¡®è®¤</button>
    </view>
  </view>

  <!-- è®¾å¤‡åˆ—è¡¨å¼¹çª— -->
  <view class="device-list-modal" wx:if="{{showDeviceList}}" catchtouchmove="true">
    <view class="modal-mask" bindtap="hideDeviceList"></view>
    <view class="modal-content">
      <view class="modal-header">
        <text>é€‰æ‹©è®¾å¤‡</text>
        <text class="close-btn" bindtap="hideDeviceList">Ã—</text>
      </view>
      <view class="available-device-list">
        <!-- åˆ†ç±»æ˜¾ç¤ºè®¾å¤‡ -->
        <view class="device-list-section">
          <view class="device-list-title">ä¼ æ„Ÿå™¨è®¾å¤‡</view>
          <view class="device-item available" 
            wx:for="{{availableDevices}}" 
            wx:key="id" 
            wx:if="{{item.typeId != '55' && item.typeId != '88' && item.typeId != '99'}}"
            bindtap="selectDevice" 
            data-device="{{item}}">
            <view class="device-icon">ğŸ“Š</view>
            <view class="device-info">
              <view class="device-name">{{item.name}}</view>
              <view class="device-type">{{item.type}}</view>
            </view>
            <view class="add-icon">+</view>
          </view>
        </view>
        
        <view class="device-list-section">
          <view class="device-list-title">æ§åˆ¶å™¨è®¾å¤‡</view>
          <view class="device-item available" 
            wx:for="{{availableDevices}}" 
            wx:key="id" 
            wx:if="{{item.typeId == '55' || item.typeId == '88' || item.typeId == '99'}}"
            bindtap="selectDevice" 
            data-device="{{item}}">
            <view class="device-icon">ğŸ®</view>
            <view class="device-info">
              <view class="device-name">{{item.name}}</view>
              <view class="device-type">{{item.type}}</view>
            </view>
            <view class="add-icon">+</view>
          </view>
        </view>
      </view>
    </view>
  </view>

  <!-- åº•éƒ¨æŒ‰é’® -->
  <view class="bottom-btn">
    <button class="create-scene-btn" bindtap="createScene">ä¿å­˜åœºæ™¯</button>
  </view>
</view>