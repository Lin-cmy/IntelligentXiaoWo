<!-- pages/device-detail/device-detail.wxml -->
<view class="detail-container">
  <!-- 顶部标题栏 -->
  <view class="header">
    <view class="back-btn" bindtap="onBack">
      <text class="back-icon">←</text>
    </view>
    <text class="device-title">{{deviceName}}</text>
  </view>
  
  <!-- 设备概览卡片 -->
  <view class="device-overview">
    <view class="device-icon-container">
      <view class="device-icon">📱</view>
    </view>
    <view class="device-basic-info">
      <view class="device-id">设备ID: {{deviceId}}</view>
      <view class="device-status" wx:if="{{deviceData.length > 0}}">
        <text class="status-dot active"></text>
        <text>在线</text>
      </view>
      <view class="device-status" wx:else>
        <text class="status-dot"></text>
        <text>离线</text>
      </view>
    </view>
  </view>

  <!-- 数据表格 -->
  <view class="data-section">
    <view class="section-title">设备数据</view>
    
    <view class="data-table-container">
      <view class="table-header">
        <view class="table-cell time-cell">更新时间</view>
        <view class="table-cell topic-cell">属性名称</view>
        <view class="table-cell value-cell">属性值</view>
      </view>
      
      <scroll-view class="table-body" scroll-y>
        <block wx:if="{{deviceData.length > 0}}">
          <view class="table-row" wx:for="{{deviceData}}" wx:key="id">
            <view class="table-cell time-cell">{{item.formattedTime}}</view>
            <view class="table-cell topic-cell">{{item.dataTopic}}</view>
            <view class="table-cell value-cell">{{item.dataValue}}</view>
          </view>
        </block>
        <view wx:else class="empty-data">
          <image class="empty-icon" src="/images/empty-data.png" mode="aspectFit"></image>
          <text>暂无设备数据</text>
        </view>
      </scroll-view>
    </view>
    
    <!-- 刷新按钮 -->
    <view class="refresh-container">
      <button class="refresh-btn" bindtap="refreshData">
        <text class="refresh-icon">↻</text>
        <text>刷新数据</text>
      </button>
    </view>
  </view>
  
  <!-- 设备控制区域 (根据设备类型显示) -->
  <view class="control-section" wx:if="{{deviceTypeId == '55' || deviceTypeId == '88' || deviceTypeId ==  '99'}}">
    <view class="section-title">设备控制</view>
  
    <!-- 风扇控制器 (deviceTypeId: 55 或 99) -->
    <view class="fan-control" wx:if="{{deviceTypeId == '55' || deviceTypeId == '99'}}">
      <view class="control-description">{{deviceTypeId == '55' ? '风扇' : '水泵'}}挡位控制</view>
    
      <view class="fan-levels">
        <view class="fan-level {{selectedLevel == 0 ? 'selected' : ''}}" 
          bindtap="selectLevel" data-level="0">
          <view class="level-icon level-off">●</view>
          <text>关闭</text>
        </view>
      
        <view class="fan-level {{selectedLevel == 1 ? 'selected' : ''}}" 
          bindtap="selectLevel" data-level="1">
          <view class="level-icon level-low">●</view>
          <text>低速</text>
        </view>
      
        <view class="fan-level {{selectedLevel == 2 ? 'selected' : ''}}" 
          bindtap="selectLevel" data-level="2">
          <view class="level-icon level-medium">●</view>
          <text>中速</text>
        </view>
      
        <view class="fan-level {{selectedLevel == 3 ? 'selected' : ''}}" 
          bindtap="selectLevel" data-level="3">
          <view class="level-icon level-high">●</view>
          <text>高速</text>
        </view>
      
        <view class="fan-level {{selectedLevel == 4 ? 'selected' : ''}}" 
          bindtap="selectLevel" data-level="4">
          <view class="level-icon level-auto">●</view>
          <text>自动</text>
        </view>
      </view>
    </view>
  
    <!-- 灯光控制器 (deviceTypeId: 88) -->
    <view class="light-control" wx:if="{{deviceTypeId == '88'}}">
      <view class="control-description">灯光亮度控制</view>
    
      <view class="light-buttons">
        <view class="light-button {{selectedLevel == 0 ? 'selected' : ''}}" 
          bindtap="selectLevel" data-level="0">
          <view class="light-icon light-off">○</view>
          <text>关闭</text>
        </view>
      
        <view class="light-button {{selectedLevel == 101 ? 'selected' : ''}}" 
          bindtap="selectLevel" data-level="101">
          <view class="light-icon light-auto">⟳</view>
          <text>自动</text>
        </view>
      </view>
    
      <view class="brightness-control">
        <text class="brightness-label">亮度: {{selectedLevel == 0 ? '关闭' : selectedLevel == 101 ? '自动' : selectedLevel + '%'}}</text>
        <slider 
          min="1" 
          max="100" 
          step="1" 
          activeColor="#7FB69F" 
          backgroundColor="#e0e0e0"
          blockSize="28"
          value="{{selectedLevel >= 0 && selectedLevel <= 100 ? selectedLevel : 0}}"
          bindchange="onSliderChange"
        />
      </view>
    </view>
  
    <!-- 确认按钮 -->
    <view class="confirm-container">
      <button class="confirm-btn" bindtap="confirmOperation">
        确认设置
      </button>
    </view>
  </view>
</view>